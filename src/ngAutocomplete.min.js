angular.module("ngAutocomplete",[]).directive("ngAutocomplete",["$timeout","$window","$q","$log",function(e,o,n,t){function s(e,o){var n=document.createElement("script");n.src=e+o;document.body.appendChild(n)}function l(){var e=n.defer();o.googleMapsInitialized=function(){e.resolve()};s("//maps.googleapis.com/maps/api/js?libraries=places&sensor=false&callback=","googleMapsInitialized");return e.promise}return{require:"ngModel",scope:{ngModel:"=",options:"=?",details:"=?"},link:function(n,s,a,i){var c;var u=false;var r=function(){if(n.gPlace==undefined){n.gPlace=new google.maps.places.Autocomplete(s[0],{})}google.maps.event.addListener(n.gPlace,"place_changed",function(){var o=n.gPlace.getPlace();if(o!==undefined){if(o.address_components!==undefined){n.$evalAsync(function(){n.details=o;i.$setViewValue(s.val())});e(function(){n.$emit("ngAutocomplete:details")})}else{if(u){g(o)}}}})};var p=function(){c={};if(n.options){if(n.options.watchEnter!==true){u=false}else{u=true}if(n.options.types){c.types=[];c.types.push(n.options.types);n.gPlace.setTypes(c.types)}else{n.gPlace.setTypes([])}if(n.options.bounds){c.bounds=n.options.bounds;n.gPlace.setBounds(c.bounds)}else{n.gPlace.setBounds(null)}if(n.options.country){c.componentRestrictions={country:n.options.country};n.gPlace.setComponentRestrictions(c.componentRestrictions)}else{n.gPlace.setComponentRestrictions(null)}}};var g=function(o){var t=new google.maps.places.AutocompleteService;if(o.name.length>0){t.getPlacePredictions({input:o.name,offset:o.name.length},function l(o,t){if(o==null||o.length==0){n.$evalAsync(function(){n.details=null});e(function(){n.$emit("ngAutocomplete:details")})}else{var l=new google.maps.places.PlacesService(s[0]);l.getDetails({reference:o[0].reference},function a(o,t){if(t==google.maps.GeocoderStatus.OK){n.$evalAsync(function(){i.$setViewValue(o.formatted_address);s.val(o.formatted_address);n.details=o;var e=s.on("focusout",function(e){s.val(o.formatted_address);s.unbind("focusout")})});e(function(){n.$emit("ngAutocomplete:details")})}})}})}};i.$render=function(){var e=i.$viewValue;s.val(e)};n.watchOptions=function(){return n.options};n.$watch(n.watchOptions,function(){p()},true);if(o.google&&o.google.maps&&o.google.maps.places){console.log("already loaded");r()}else{t.log("not loaded");l().then(function(){console.log("promise resolved");if(o.google&&o.google.maps&&o.google.maps.places){r();console.log("gmaps loaded")}else{console.log("gmaps not loaded")}},function(){console.log("promise rejected")})}}}}]);